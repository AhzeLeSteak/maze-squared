(function(){"use strict";var t={6909:function(t,e,n){n.d(e,{_:function(){return c},i:function(){return i}});var i,s=n(2482),o=(n(7658),n(1703),n(6673)),r=n(7248),a=n(7670);(function(t){t[t["HORIZONTAL"]=0]="HORIZONTAL",t[t["VERTICAL"]=1]="VERTICAL"})(i||(i={}));class c{constructor(){(0,s.Z)(this,"tiles",[]),(0,s.Z)(this,"starting_pos",{x:4,y:4}),(0,s.Z)(this,"ending_pos",{x:1,y:8}),(0,s.Z)(this,"size",{x:10,y:10}),this.load(!0)}load(t=!1){if(this.tiles=new Array(this.size.x*this.size.y).fill(0).map(((t,e)=>e<this.size.x||e>this.size.x*(this.size.y-1)||e%this.size.x===0||(e+1)%this.size.x===0?new o.n9(1):new o.n9(0))),!t)return;const e=new a.cX,n={x:8,y:5};this.set_tile(n,e);const i=new a.cX,s={x:8,y:8};this.set_tile(s,i),e.twin_index=this.vector_to_map_index(s),i.twin_index=this.vector_to_map_index(n),i.rotate(2),this.set_tile({x:n.x-1,y:n.y},new o.n9(1)),this.set_tile({x:n.x-1,y:n.y-1},new o.n9(1)),this.set_tile({x:n.x-1,y:n.y+1},new o.n9(1)),this.set_tile({x:n.x,y:n.y-1},new o.n9(1)),this.set_tile({x:s.x-1,y:s.y},new o.n9(1))}load_from_serialized(t){console.log(this),this.tiles=[];for(let e of t.tiles)if("base"===e.tile_type)this.tiles.push(new o.n9(e.solid));else{const t=new a.cX;t.twin_index=e.twin_index,t.entrance=e.entrance,this.tiles.push(t)}this.size=t.size,this.starting_pos=t.starting_pos,this.ending_pos=t.ending_pos,console.log(this)}vector_to_map_index(t){return Math.floor(t.x)+Math.floor(t.y)*this.size.x}map_index_to_vector(t){if(t<0||t>this.tiles.length)throw new Error(t+" out of array bound");return{x:t%this.size.x,y:Math.floor(t/this.size.x)}}tile(t,e,n=!0,i=!1){if(n&&(t=Math.floor(t),e=Math.floor(e)),this.isOutOfBound({x:t,y:e})){if(i)return o.NN;throw new Error(`Out of bound : {x:${t}, y:${e}}`)}return this.tiles[t+e*this.size.x]}isOutOfBound({x:t,y:e}){return t<0||e<0||t>=this.size.x||e>=this.size.y}set_tile(t,e){const n=this.vector_to_map_index(t);this.tiles[n]=e}replace_tile(t,e){const n=this.get_coords_of_tile(t);this.set_tile(n,e)}get_coords_of_tile(t){return this.map_index_to_vector(this.tiles.findIndex((e=>e===t)))}get_next_wall(t,e){e=(e+r.dX)%r.dX;const n=[{...t}];let s=this.get_tile_from_side_coords(t,e,!0),o=!1;const a={v:{...t},angle:e,distance:0,orientation:i.HORIZONTAL};do{if(s.get_next_point(this,a,n))break;n.push({...a.v}),s=this.get_tile_from_side_coords(a.v,a.angle),o=1===s.solid||a.distance>100}while(!o);const c=(a.orientation===i.HORIZONTAL?a.v.x:a.v.y)%1;return{...a,wallCol:c,points:n}}get_tile_from_side_coords({x:t,y:e},n,i=!1){const s=t===Math.floor(t),o=e===Math.floor(e);if(s){const i=(0,r.gI)(n);return this.tile(t+(i?-1:0),e,!0,!0)}if(o){const i=(0,r.qp)(n);return this.tile(t,e+(i?0:-1),!0,!0)}if(i)return this.tile(t,e,!0,!1);throw new Error(`Get Tile from Side coords {x:${t}, y:${e}}`)}}},3594:function(t,e,n){var i;n.d(e,{N:function(){return i},w:function(){return s}}),function(t){t[t["RIGHT"]=0]="RIGHT",t[t["DOWN"]=1]="DOWN",t[t["LEFT"]=2]="LEFT",t[t["UP"]=3]="UP"}(i||(i={}));const s=t=>(t+2)%4},7248:function(t,e,n){n.d(e,{Ly:function(){return s},Q7:function(){return a},dX:function(){return o},f5:function(){return r},gI:function(){return c},pi:function(){return i},qp:function(){return h}});const i=Math.PI,s=i/180,o=2*i,r=i/2,a=t=>(t+o)%o,c=t=>t>=r&&t<=i+r,h=t=>t<=i},1310:function(t,e,n){n.d(e,{T:function(){return s},x:function(){return o}});var i=n(2482);n(7658);const s=(t,e)=>255*Math.sqrt((t.r-e.r)**2+(t.g-e.g)**2+(t.b-e.b)**2);class o{constructor(t,e){(0,i.Z)(this,"size",void 0),(0,i.Z)(this,"columns",void 0),this.size=e,this.columns=[];for(let n=0;n<this.size.x;n++)this.columns.push(t.filter(((t,e)=>e%this.size.y===n)))}}},3127:function(t,e,n){n.d(e,{C:function(){return a},P:function(){return r}});n(7658);var i=n(1310),s=n(2201);class o extends s.H{constructor(t){super({x:t.width,y:t.height}),this.contextd2D.drawImage(t,0,0),this.canvas.setAttribute("willReadFrequently","true")}getTexture(){const t=[];for(let e=0;e<this.size.y;e++)for(let n=0;n<this.size.x;n++){const i=this.contextd2D.getImageData(n,e,1,1).data;t.push({r:i[0],g:i[1],b:i[2]})}return new i.x(t,{...this.size})}delete(){this.canvas.remove()}drawContext(t,e){}}const r=new Map;function a(){const t=["wall.png","wall_2.png","floor.png","floor_2.png"],e=t=>{const e=t.split("/");return e[e.length-1].split(".")[0]},n=[];return t.forEach((t=>{const i=new Image;i.src=`assets/textures/${t}`,n.push(new Promise((n=>{i.addEventListener("load",(()=>{const s=new o(i);r.set(e(t),s.getTexture()),s.delete(),n()}))})))})),Promise.all(n)}},7670:function(t,e,n){n.d(e,{cX:function(){return h}});var i,s=n(2482),o=n(6673),r=n(7248),a=n(3594);(function(t){t[t["hearts"]=0]="hearts",t[t["diamonds"]=1]="diamonds",t[t["clubs"]=2]="clubs",t[t["spades"]=3]="spades"})(i||(i={}));function c(t,e,n){let i=Math.sin(e),s=Math.cos(e);n.x-=t.x,n.y-=t.y;let o=n.x*s-n.y*i,r=n.x*i+n.y*s;return n.x=o+t.x,n.y=r+t.y,n}class h extends o.n9{constructor(t=a.N.DOWN){super(0),(0,s.Z)(this,"entrance",void 0),(0,s.Z)(this,"twin_index",-1),this.entrance=t,this.tile_type="teleporter"}get has_twin(){return this.twin_index>=0}get_next_point(t,e,n){const i=e.v.x%1===0?(0,r.gI)(e.angle)?a.N.LEFT:a.N.RIGHT:(0,r.qp)(e.angle)?a.N.DOWN:a.N.UP;return i!==(0,a.w)(this.entrance)||(this.teleport(t,e.v,i,n),this.rotateObject(t,e,e.v,n),super.get_next_point(t,e,n))}on_walk(t,e,n){super.on_walk(t,e,n),this.teleport(t,e.pos,n),this.rotateObject(t,e,e.pos)}teleport(t,e,n,i){const s=t.get_coords_of_tile(this),o=t.get_coords_of_tile(this.twin(t));e.x+=-s.x+o.x,e.y+=-s.y+o.y,n===a.N.UP?e.y--:n===a.N.DOWN?e.y++:n===a.N.RIGHT?e.x++:n===a.N.LEFT&&e.x--,i?.push({...e,new_line:!0})}rotate(t=1){this.entrance=(this.entrance+t)%4}rotateObject(t,e,n,i){const s=(2+this.twin(t).entrance-this.entrance)%4;if(0!==s){const o=r.f5*s,a=t.get_coords_of_tile(this.twin(t));c({x:a.x+.5,y:a.y+.5},o,n),e.angle=(0,r.Q7)(e.angle+o),i?.pop(),i?.push({...n,new_line:!0})}}can_go_through(t){return t===(0,a.w)(this.entrance)}twin(t){return t.tiles[this.twin_index]}}},6673:function(t,e,n){n.d(e,{NN:function(){return a},n9:function(){return r}});var i=n(2482),s=n(7248),o=n(6909);class r{constructor(t){(0,i.Z)(this,"solid",void 0),(0,i.Z)(this,"tile_type","base"),this.solid=t}can_go_through(t){return 0===this.solid}get_next_point(t,e,n){const i=e.v.x%1,r=e.v.y%1,a=e.angle;if(0===a)return e.v.x++,e.distance++,e.orientation=o.i.VERTICAL,!0;if(a===Math.PI)return e.v.x--,e.distance++,e.orientation=o.i.VERTICAL,!0;if(a===3*Math.PI/2)return e.v.y--,e.distance++,e.orientation=o.i.HORIZONTAL,!0;if(a===Math.PI/2)return e.v.y++,e.distance++,e.orientation=o.i.HORIZONTAL,!0;const c=a>=Math.PI/2&&a<=3*Math.PI/2,h=a<=Math.PI;let u=c?i%1:1-i%1,l=h?1-r%1:r%1;u=0===u?1:u,l=0===l?1:l;let d=u*Math.tan(c?(0,s.Q7)(Math.PI-a):a),f=l/Math.tan(h?a:(0,s.Q7)(Math.PI-a));const p=f/Math.cos(a),g=d/Math.sin(a);return g<p?(e.v.y+=d,e.v.x+=u*(c?-1:1),e.distance+=g,e.orientation=o.i.VERTICAL):(e.v.x+=f,e.v.y+=l*(h?1:-1),e.distance+=p,e.orientation=o.i.HORIZONTAL),!1}on_walk(t,e,n){}}const a=new r(1);new r(0)},912:function(t,e,n){n.d(e,{X:function(){return s}});var i=n(2482);class s{constructor(t,e){(0,i.Z)(this,"size",void 0),(0,i.Z)(this,"canvas",void 0),this.size=t,this.canvas=e||this.createCanvas(),this.size.x=Math.floor(this.size.x),this.size.y=Math.floor(this.size.y),this.resizeCanvasHtml(this.canvas,this.size)}async init(){}resizeCanvasHtml(t,e){t.setAttribute("width",e.x+""),t.setAttribute("height",e.y+"")}createCanvas(t=!0){const e="canvas_"+s.id++,n=document.createElement("canvas");return n.setAttribute("id",e),n.setAttribute("style","border: 3px solid black"),t&&n.classList.add("centered"),document.getElementById("canvas-container")?.appendChild(n),n}}(0,i.Z)(s,"id",0)},2201:function(t,e,n){n.d(e,{H:function(){return o}});var i=n(2482),s=n(912);class o extends s.X{constructor(t,e){super(t,e),(0,i.Z)(this,"contextd2D",void 0);const n=this.canvas.getContext("2d");n.lineCap="round",n.lineJoin="round",n.strokeStyle="black",n.lineWidth=1,this.contextd2D=n}drawLine(t,e,n,i){this.contextd2D.beginPath(),this.contextd2D.moveTo(t,e),this.contextd2D.lineTo(n,i),this.contextd2D.stroke()}drawSquare(t,e,n,i){this.contextd2D.fillRect(t,e,n,i)}reset(){this.contextd2D.clearRect(0,0,this.size.x,this.size.y)}setColor(t,e,n){this.contextd2D.strokeStyle=`rgb(${t}, ${e}, ${n})`}}},7526:function(t,e,n){var i=n(9242),s=n(3396);const o=(0,s._)("div",{class:"background"},null,-1),r=(0,s._)("a",{href:"https://github.com/AhzeLeSteak/maze-squared",title:"Github repo"},[(0,s._)("img",{id:"main-logo",alt:"main_logo",src:"assets/ui/logo.png"})],-1),a={key:0};function c(t,e,n,i,c,h){const u=(0,s.up)("router-view");return(0,s.wg)(),(0,s.iD)(s.HY,null,[o,r,t.inited?((0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(u,{game:t.game},null,8,["game"])])):(0,s.kq)("",!0)],64)}n(7658);var h=n(2482),u=n(7248),l=n(3594);class d{constructor(t){(0,h.Z)(this,"pos",void 0),(0,h.Z)(this,"angle",u.f5+.01),(0,h.Z)(this,"speed",2),(0,h.Z)(this,"rotation_speed",120),this.pos=t,this.pos={x:t.x+.5,y:t.y+.5}}addAngle(t){this.angle+=t,this.angle=(0,u.Q7)(this.angle)}walk(t,e,n=this.angle){const i=this.getNextPointWalking(e,n),s={x:Math.floor(i.x)-Math.floor(this.pos.x),y:Math.floor(i.y)-Math.floor(this.pos.y)},o=1===s.x?l.N.RIGHT:-1===s.x?l.N.LEFT:1===s.y?l.N.DOWN:l.N.UP;t.tile(i.x,i.y,!0,!0).can_go_through(o)&&(this.pos.x=i.x,this.pos.y=i.y),t.tile(this.pos.x,this.pos.y,!0).on_walk(t,this,o)}getNextPointWalking(t,e=this.angle,n=this.speed){const i=this.pos.x+Math.cos(e)*n*t,s=this.pos.y+Math.sin(e)*n*t;return{x:i,y:s}}update(t){}}var f=n(6909);class p{constructor(t){(0,h.Z)(this,"game",void 0),(0,h.Z)(this,"UP",!1),(0,h.Z)(this,"DOWN",!1),(0,h.Z)(this,"LEFT",!1),(0,h.Z)(this,"RIGHT",!1),(0,h.Z)(this,"STRAFE_LEFT",!1),(0,h.Z)(this,"STRAFE_RIGHT",!1),this.game=t,this.bindEvents()}update(t){const e=this.game.player.rotation_speed;this.RIGHT?this.game.player.addAngle(u.Ly*e*t):this.LEFT&&this.game.player.addAngle(-u.Ly*e*t);const n=this.STRAFE_LEFT||this.STRAFE_RIGHT,i=this.UP||this.DOWN;if(!n&&!i)return;let s=1,o=0,r=this.game.player.angle;n&&(o=this.STRAFE_RIGHT?u.f5:-u.f5),i&&(this.DOWN&&(r+=u.pi),n&&(o/=this.DOWN?-2:2,s=1/Math.sqrt(2))),this.game.player.walk(this.game.map,t*s,r+o)}bindEvents(){const t=t=>{const e="keydown"===t.type;switch(t.code){case"KeyW":this.UP=e;break;case"KeyS":this.DOWN=e;break;case"KeyQ":this.LEFT=e;break;case"KeyE":this.RIGHT=e;break;case"KeyA":this.STRAFE_LEFT=e;break;case"KeyD":this.STRAFE_RIGHT=e;break}};document.addEventListener("keydown",t),document.addEventListener("keyup",t)}}var g=n(3127);class y{constructor(t=60){(0,h.Z)(this,"fps",void 0),(0,h.Z)(this,"player",void 0),(0,h.Z)(this,"map",void 0),(0,h.Z)(this,"controller",void 0),(0,h.Z)(this,"view_angle",70),(0,h.Z)(this,"requestAnimationFrameId",0),this.fps=t,console.log("Instanciating Game class"),this.controller=new p(this),this.map=new f._,this.player=new d(this.map.starting_pos)}async init(){console.log("Waiting for textures to load"),await(0,g.C)(),console.log("Textures loaded",g.P)}async start_loop(t){let e=0;const n=i=>{const s=(i-e)/1e3;this.update(s),t.drawContext(this,s),e=i,this.requestAnimationFrameId=requestAnimationFrame(n)};this.requestAnimationFrameId=requestAnimationFrame(n)}stop(){cancelAnimationFrame(this.requestAnimationFrameId)}update(t){try{this.controller.update(t),this.player.update(this.map)}finally{}}}var _=n(2483);const v=[{path:"/play",name:"play",component:()=>n.e(872).then(n.bind(n,872))},{path:"/edit",name:"edit",component:()=>n.e(609).then(n.bind(n,1609))},{path:"/:catchAll(.*)",redirect:"/play"}],x=(0,_.p7)({history:(0,_.r5)(),routes:v});var m=(0,s.aZ)({name:"App",data(){return{inited:!1,game:new y}},mounted(){this.game.init().then((()=>this.inited=!0)),document.addEventListener("keydown",(t=>{"KeyP"===t.code&&x.push("play"===this.$route.name?"/edit":"play")}))}}),w=n(89);const b=(0,w.Z)(m,[["render",c]]);var T=b;(0,i.ri)(T).use(x).mount("#app")}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={exports:{}};return t[i](o,o.exports,n),o.exports}n.m=t,function(){var t=[];n.O=function(e,i,s,o){if(!i){var r=1/0;for(u=0;u<t.length;u++){i=t[u][0],s=t[u][1],o=t[u][2];for(var a=!0,c=0;c<i.length;c++)(!1&o||r>=o)&&Object.keys(n.O).every((function(t){return n.O[t](i[c])}))?i.splice(c--,1):(a=!1,o<r&&(r=o));if(a){t.splice(u--,1);var h=s();void 0!==h&&(e=h)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[i,s,o]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,i){return n.f[i](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{609:"b9e45a77",872:"63b107ff"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/"+t+"."+{609:"7034658e",872:"7387f3e2"}[t]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="maze-squared:";n.l=function(i,s,o,r){if(t[i])t[i].push(s);else{var a,c;if(void 0!==o)for(var h=document.getElementsByTagName("script"),u=0;u<h.length;u++){var l=h[u];if(l.getAttribute("src")==i||l.getAttribute("data-webpack")==e+o){a=l;break}}a||(c=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+o),a.src=i),t[i]=[s];var d=function(e,n){a.onerror=a.onload=null,clearTimeout(f);var s=t[i];if(delete t[i],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((function(t){return t(n)})),e)return e(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/maze-squared/"}(),function(){var t=function(t,e,n,i){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css";var o=function(o){if(s.onerror=s.onload=null,"load"===o.type)n();else{var r=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=r,c.request=a,s.parentNode.removeChild(s),i(c)}};return s.onerror=s.onload=o,s.href=e,document.head.appendChild(s),s},e=function(t,e){for(var n=document.getElementsByTagName("link"),i=0;i<n.length;i++){var s=n[i],o=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===t||o===e))return s}var r=document.getElementsByTagName("style");for(i=0;i<r.length;i++){s=r[i],o=s.getAttribute("data-href");if(o===t||o===e)return s}},i=function(i){return new Promise((function(s,o){var r=n.miniCssF(i),a=n.p+r;if(e(r,a))return s();t(i,a,s,o)}))},s={143:0};n.f.miniCss=function(t,e){var n={609:1,872:1};s[t]?e.push(s[t]):0!==s[t]&&n[t]&&e.push(s[t]=i(t).then((function(){s[t]=0}),(function(e){throw delete s[t],e})))}}(),function(){var t={143:0};n.f.j=function(e,i){var s=n.o(t,e)?t[e]:void 0;if(0!==s)if(s)i.push(s[2]);else{var o=new Promise((function(n,i){s=t[e]=[n,i]}));i.push(s[2]=o);var r=n.p+n.u(e),a=new Error,c=function(i){if(n.o(t,e)&&(s=t[e],0!==s&&(t[e]=void 0),s)){var o=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",a.name="ChunkLoadError",a.type=o,a.request=r,s[1](a)}};n.l(r,c,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,i){var s,o,r=i[0],a=i[1],c=i[2],h=0;if(r.some((function(e){return 0!==t[e]}))){for(s in a)n.o(a,s)&&(n.m[s]=a[s]);if(c)var u=c(n)}for(e&&e(i);h<r.length;h++)o=r[h],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(u)},i=self["webpackChunkmaze_squared"]=self["webpackChunkmaze_squared"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(7526)}));i=n.O(i)})();
//# sourceMappingURL=app.f0245ed6.js.map