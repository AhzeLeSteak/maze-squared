"use strict";(self["webpackChunkmaze_squared"]=self["webpackChunkmaze_squared"]||[]).push([[609],{8385:function(t,e,s){s(7658),Array.prototype.chunk=function(t){const e=[];for(let s=0;s<this.length;s+=t)e.push(this.slice(s,s+t));return e}},1609:function(t,e,s){s.r(e),s.d(e,{default:function(){return C}});var i=s(3396),o=s(7139);const l={key:0,class:"toolbox"},n=["title","onClick"],r={class:"centered",style:{display:"flex"}},a=(0,i.uE)('<div style="display:none;"><img id="hearts" src="/assets/ui/toolbox/tp_hearts.png"><img id="clubs" src="/assets/ui/toolbox/tp_clubs.png"><img id="diamonds" src="/assets/ui/toolbox/tp_diamonds.png"><img id="spades" src="/assets/ui/toolbox/tp_spades.png"></div>',1);function c(t,e,s,c,p,_){return(0,i.wg)(),(0,i.iD)(i.HY,null,[t.level_editor?((0,i.wg)(),(0,i.iD)("div",l,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.level_editor.AVAILABLE_TOOLS,((e,s)=>((0,i.wg)(),(0,i.iD)("button",{style:(0,o.j5)(t.tool_style(e.texture_name,s)),title:e.tooltip,onClick:e=>t.level_editor.select(s)},null,12,n)))),256))])):(0,i.kq)("",!0),(0,i._)("div",r,[(0,i._)("canvas",{id:"top-view",onClick:e[0]||(e[0]=e=>t.level_editor.click(e)),onMousedown:e[1]||(e[1]=e=>t.level_editor.dragging=e.button),onMouseup:e[2]||(e[2]=e=>t.level_editor.dragging=-1),onContextmenu:e[3]||(e[3]=e=>t.level_editor.context_menu(e)),onMousemove:e[4]||(e[4]=e=>t.level_editor.mouse_move(e)),onMouseleave:e[5]||(e[5]=e=>t.level_editor.mouse_leave(e))},null,32),a])],64)}var p=s(2482),_=s(7248),d=s(2201),h=s(6909),u=s(3594),x=s(6673);class m extends d.H{constructor(t,e,s){super({x:t.map.size.x*e,y:t.map.size.y*e},s),(0,p.Z)(this,"tile_size",void 0),(0,p.Z)(this,"last_player_pos",void 0),(0,p.Z)(this,"tile_pos_hovered",void 0),(0,p.Z)(this,"draw_player",!0),this.tile_size=e,this.last_player_pos={x:1/0,y:1/0}}drawContext(t){this.size={x:t.map.size.x*this.tile_size,y:t.map.size.y*this.tile_size},this.resizeCanvasHtml(this.canvas,this.size),this.reset();const e=this.tile_size;this.contextd2D.strokeStyle="black",this.contextd2D.font=Math.floor(.3*e)+"px Comic sans";const s=t.map;for(let o=0;o<s.size.y;o++)for(let t=0;t<s.size.x;t++){const i=s.tile(t,o,!1);if(this.contextd2D.fillStyle="teleporter"===i.tile_type?"purple":["grey","black"][i.solid]??"yellow",this.drawSquare(t*e+1,o*e+1,e-2,e-2),"teleporter"===i.tile_type){const s=i;this.contextd2D.fillStyle="rgba(66,58,58,0.9)";const l=e/5;this.drawSquare(t*e+(s.entrance===u.N.RIGHT?e-l:0),o*e+(s.entrance===u.N.DOWN?e-l:0),[u.N.UP,u.N.DOWN].includes(s.entrance)?e:l,[u.N.LEFT,u.N.RIGHT].includes(s.entrance)?e:l)}}const i=.3;if(this.contextd2D.fillStyle="rgba(18,255,73, 1)",this.drawSquare((t.map.starting_pos.x+.5-i/2)*e,(t.map.starting_pos.y+.5-i/2)*e,e*i,e*i),this.contextd2D.fillStyle="rgba(255, 18,73, 1)",this.drawSquare((t.map.ending_pos.x+.5-i/2)*e,(t.map.ending_pos.y+.5-i/2)*e,e*i,e*i),this.draw_player){const i={...t.player.pos};for(let u=-t.view_angle/2;0;u++)for(let i=0;i<1;i++){const o=t.player.angle+(u+i/2)*_.Ly,l=s.get_next_wall(t.player.pos,o);l.orientation===h.i.HORIZONTAL?this.setColor(55,200,40):this.setColor(50,85,255);for(let t=0;t<l.points.length-1;t++){const s=l.points[t],i=l.points[t+1];i.new_line||this.drawLine(s.x*e,s.y*e,i.x*e,i.y*e)}}const{v:o,distance:l,points:n,angle:r}=t.map.get_next_wall(i,t.player.angle);for(let t=0;t<n.length-1&&t<64;t++){this.contextd2D.strokeStyle=t%2===0?"cyan":"darkred";const s=n[t],i=n[t+1];i.new_line||this.drawLine(s.x*e,s.y*e,i.x*e,i.y*e)}const a=t.map.get_tile_from_side_coords(o,r);if(a!==x.NN){const s=t.map.get_coords_of_tile(a);this.drawSquare(s.x*e,s.y*e,e,e)}this.contextd2D.fillStyle="darkblue",this.contextd2D.fillText(l.toString().substring(0,4),(i.x+o.x)*e/2,(i.y+o.y)*e/2);let c=Math.floor(t.player.pos.x)*e,p=Math.floor(t.player.pos.y)*e;this.contextd2D.fillStyle="rgba(100, 100, 100, 0.6)",this.drawSquare(c+1,p+1,e-2,e-2),this.contextd2D.strokeStyle="red",this.contextd2D.fillStyle="red";const d=8;this.drawSquare(i.x*e-d/2,i.y*e-d/2,d,d),this.contextd2D.fillStyle="black",this.contextd2D.font="16px Comic sans",this.contextd2D.fillText((t.player.angle/_.pi).toFixed(2)+"pi",i.x*e+10,i.y*e+10)}if(this.tile_pos_hovered&&!s.isOutOfBound(this.tile_pos_hovered)){const s=Math.floor(this.tile_pos_hovered.x)*e,i=Math.floor(this.tile_pos_hovered.y)*e;this.contextd2D.fillStyle="rgba(255,255,255,0.4)",this.drawSquare(s+1,i+1,e-2,e-2);const o=t.map.tile(this.tile_pos_hovered.x,this.tile_pos_hovered.y,!1);if("teleporter"===o.tile_type){this.contextd2D.fillStyle="grey";const s=o;if(!s.has_twin)return;const i=t.map.get_coords_of_tile(s.twin(t.map));this.drawLine((this.tile_pos_hovered.x+.5)*e,(this.tile_pos_hovered.y+.5)*e,(i.x+.5)*e,(i.y+.5)*e)}}}}class g{constructor(t,e,s=!0){(0,p.Z)(this,"texture_name",void 0),(0,p.Z)(this,"tooltip",void 0),(0,p.Z)(this,"selectable",void 0),this.texture_name=t,this.tooltip=e,this.selectable=s}on_select(t){}on_unselect(t){}left_click(t,e,s){}right_click(t,e,s){}}class y extends g{constructor(){super("wall_floor","Put and remove walls")}left_click(t,e,s){this.set(t,e,(()=>new x.n9(1)))}right_click(t,e,s){this.set(t,e,(()=>new x.n9(0)))}set(t,e,s){const i=t.map.tile(e.x,e.y);"teleporter"===i.tile_type&&t.map.replace_tile(i.twin(t.map),s()),t.map.set_tile(e,s())}}class f extends g{constructor(){super("reset","Reset level",!1)}on_select(t){t.map.load()}}class v extends g{constructor(){super("start","Set player starting position")}left_click(t,e,s){const i=t.map.tile(e.x,e.y,!1);if(!i.solid&&"teleporter"!==i.tile_type)return t.map.starting_pos={...e},!0}}var w=s(7670);class k extends g{constructor(t){super("tp","Put two teleporting tiles"),(0,p.Z)(this,"canvas",void 0),(0,p.Z)(this,"remaining_clicks",2),(0,p.Z)(this,"first_tp_tile",void 0),this.canvas=t}on_select(t){this.remaining_clicks=2,this.canvas.draw_player=!1,this.first_tp_tile=void 0}on_unselect(t){if(this.canvas.draw_player=!0,0!==this.remaining_clicks)for(let e=0;e<t.map.size.y;e++)for(let s=0;s<t.map.size.x;s++){const i=t.map.tile(s,e);"teleporter"===i.tile_type&&t.map.set_tile({x:s,y:e},new x.n9(0))}}left_click(t,e,s){const i=new w.cX;return this.first_tp_tile?(this.first_tp_tile.twin_index=t.map.vector_to_map_index(e),i.twin_index=t.map.vector_to_map_index(t.map.get_coords_of_tile(this.first_tp_tile))):this.first_tp_tile=i,t.map.set_tile(e,i),0===--this.remaining_clicks}}class S extends g{constructor(){super("rotate","Rotate a teleporter")}left_click(t,e,s){const i=t.map.tile(e.x,e.y,!1);if("teleporter"!==i.tile_type)return;const o=i;o.rotate()}}class z extends g{constructor(){super("end","Set player starting position")}left_click(t,e,s){const i=t.map.tile(e.x,e.y,!1);if(!i.solid&&"teleporter"!==i.tile_type)return t.map.ending_pos={...e},!0}}class L extends g{constructor(){super("save","Save level locally",!1)}on_select(t){localStorage.setItem("map",JSON.stringify(t.map))}}class b extends g{constructor(){super("load","Load level locally",!1)}on_select(t){const e=localStorage.getItem("map");e&&(t.map.load_from_serialized(JSON.parse(e)),t.player.pos={...t.map.starting_pos})}}s(8385);class A extends g{constructor(){super("w+","Increase map width",!1)}on_select(t){const{map:e}=t;if(15===e.size.x)return;const s=e.tiles.chunk(e.size.x);e.size.x++,e.tiles=s.map((t=>[...t,new x.n9(1)])).flat()}}class D extends g{constructor(){super("w-","Decrease map width",!1)}on_select(t){const{map:e}=t;if(1===e.size.x)return;const s=e.tiles.chunk(e.size.x);e.size.x--,e.tiles=s.map((t=>t.slice(0,t.length-1))).flat()}}class O extends g{constructor(){super("h-","Reduce map height",!1)}on_select(t){const{map:e}=t;if(1!==e.size.y){for(let t=0;t<e.size.x;t++)e.tiles.pop();e.size.y--}}}s(7658);class Z extends g{constructor(){super("h+","Increase map height",!1)}on_select(t){const{map:e}=t;if(15!==e.size.y){for(let t=0;t<e.size.x;t++)e.tiles.push(new x.n9(1));e.size.y++}}}class I{constructor(t,e){(0,p.Z)(this,"game",void 0),(0,p.Z)(this,"canvas",void 0),(0,p.Z)(this,"tool_index",0),(0,p.Z)(this,"AVAILABLE_TOOLS",void 0),(0,p.Z)(this,"dragging",-1),this.game=t,this.canvas=e,this.AVAILABLE_TOOLS=[new y,new f,new k(e),new S,new v,new z,new L,new b,new A,new D,new Z,new O]}click(t){const e=this.AVAILABLE_TOOLS[this.tool_index].left_click(this.game,this.getPos(t),{x:t.offsetX,y:t.offsetY});e&&(this.AVAILABLE_TOOLS[this.tool_index].on_unselect(this.game),this.tool_index=0)}context_menu(t){t.preventDefault(),this.AVAILABLE_TOOLS[this.tool_index].right_click(this.game,this.getPos(t),{x:t.offsetX,y:t.offsetY})}mouse_move(t){this.canvas.tile_pos_hovered=this.getPos(t),this.dragging>=0&&0===this.tool_index&&(0===this.dragging?this.click(t):this.context_menu(t))}mouse_leave(t){this.canvas.tile_pos_hovered=void 0}select(t){const e=this.AVAILABLE_TOOLS[t];e.on_select(this.game),e.selectable&&(this.AVAILABLE_TOOLS[this.tool_index].on_unselect(this.game),this.tool_index=t)}getPos(t){return{x:Math.floor(t.offsetX/this.canvas.tile_size),y:Math.floor(t.offsetY/this.canvas.tile_size)}}}var T=(0,i.aZ)({name:"Edit",props:{game:{type:Object,required:!0}},data(){return{level_editor:void 0}},mounted(){const t=64,e=document.getElementById("top-view"),s=new m(this.game,t,e);this.level_editor=new I(this.game,s),this.game.start_loop(s)},unmounted(){this.game.stop()},methods:{tool_style(t,e){return`background-image: url("assets/ui/toolbox/${t}.png");`+(e===this.level_editor?.tool_index?"outline: 4px solid red;":"")}}}),N=s(89);const q=(0,N.Z)(T,[["render",c]]);var C=q}}]);
//# sourceMappingURL=609.b9e45a77.js.map