(function(){"use strict";var t={872:function(t,e,n){n.d(e,{C:function(){return h},P:function(){return a}});n(7658);var s=n(2482);class o{constructor(t,e){(0,s.Z)(this,"size",void 0),(0,s.Z)(this,"columns",void 0),this.size=e,this.columns=[];for(let n=0;n<this.size.x;n++)this.columns.push(t.filter(((t,e)=>e%this.size.y===n)))}}var i=n(2201);class r extends i.H{constructor(t){super({x:t.width,y:t.height}),this.contextd2D.drawImage(t,0,0)}getTexture(){const t=[];for(let e=0;e<this.size.y;e++)for(let n=0;n<this.size.x;n++){const s=this.contextd2D.getImageData(n,e,1,1).data;t.push({r:s[0],g:s[1],b:s[2]})}return new o(t,{...this.size})}delete(){this.canvas.remove()}drawContext(t,e){console.log("image")}}const a=new Map;function h(){const t=["wall.png","wall_2.png","floor.png"],e=t=>{const e=t.split("/");return e[e.length-1].split(".")[0]},n=[];return t.forEach((t=>{const s=new Image;s.src=`assets/textures/${t}`,n.push(new Promise((n=>{s.addEventListener("load",(()=>{const o=new r(s);a.set(e(t),o.getTexture()),o.delete(),n()}))})))})),Promise.all(n)}},954:function(t,e,n){n.d(e,{Ly:function(){return o},dX:function(){return i},f5:function(){return r},pi:function(){return s}});const s=Math.PI,o=s/180,i=2*s,r=s/2},912:function(t,e,n){n.d(e,{X:function(){return o}});var s=n(2482);class o{constructor(t,e){(0,s.Z)(this,"size",void 0),(0,s.Z)(this,"canvas",void 0),this.size=t,this.canvas=e||this.createCanvas(),this.size.x=Math.floor(this.size.x),this.size.y=Math.floor(this.size.y),this.resizeCanvasHtml(this.canvas,this.size)}resizeCanvasHtml(t,e){t.setAttribute("width",e.x+""),t.setAttribute("height",e.y+"")}createCanvas(t=!0){const e="canvas_"+o.id++,n=document.createElement("canvas");return n.setAttribute("id",e),n.setAttribute("style","border: 3px solid black"),t&&n.classList.add("centered"),document.getElementById("canvas-container")?.appendChild(n),n}}(0,s.Z)(o,"id",0)},2201:function(t,e,n){n.d(e,{H:function(){return i}});var s=n(2482),o=n(912);class i extends o.X{constructor(t,e){super(t,e),(0,s.Z)(this,"contextd2D",void 0);const n=this.canvas.getContext("2d");n.lineCap="round",n.lineJoin="round",n.strokeStyle="black",n.lineWidth=1,this.contextd2D=n}drawLine(t,e,n,s){this.contextd2D.beginPath(),this.contextd2D.moveTo(t,e),this.contextd2D.lineTo(n,s),this.contextd2D.stroke()}drawSquare(t,e,n,s){this.contextd2D.fillRect(t,e,n,s)}reset(){this.contextd2D.fillStyle="white",this.drawSquare(0,0,this.size.x,this.size.y)}setColor(t,e,n){this.contextd2D.strokeStyle=`rgb(${t}, ${e}, ${n})`}}},9182:function(t,e,n){var s=n(9242),o=n(3396);const i=(0,o._)("div",{class:"background"},null,-1),r=(0,o._)("a",{href:"https://github.com/AhzeLeSteak/maze-squared",title:"Github repo"},[(0,o._)("img",{src:"/assets/ui/logo.png",id:"main-logo",alt:"main_logo"})],-1),a={key:0};function h(t,e,n,s,h,c){const u=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)(o.HY,null,[i,r,t.inited?((0,o.wg)(),(0,o.iD)("div",a,[(0,o.Wm)(u,{game:t.game},null,8,["game"])])):(0,o.kq)("",!0)],64)}n(7658);var c=n(2482),u=n(954);class l{constructor(t){(0,c.Z)(this,"pos",void 0),(0,c.Z)(this,"angle",-u.f5),(0,c.Z)(this,"speed",2),(0,c.Z)(this,"rotation_speed",120),(0,c.Z)(this,"box_type",0),this.pos=t,this.pos.x+=.5,this.pos.y+=.5}addAngle(t){this.angle+=t,this.angle=(this.angle+u.dX)%u.dX}walk(t,e,n=this.angle){const s=this.getNextPointWalking(e,n),o={...this.pos};1!==t.box(s.x,s.y,!0)?(this.pos.x=s.x,this.pos.y=s.y):1!==t.box(this.pos.x,s.y,!0)?this.pos.y=s.y:1!==t.box(s.x,this.pos.y,!0)&&(this.pos.x=s.x);const i={x:Math.floor(this.pos.x)-Math.floor(o.x),y:Math.floor(this.pos.y)-Math.floor(o.y)},r=1===i.x?"RIGHT":-1===i.x?"LEFT":1===i.y?"DOWN":"UP",a=Math.floor(t.box(this.pos.x,this.pos.y));if(a>1&&this.box_type!==a){const{v:e,angle:n}=t.getThrough({x:this.pos.x,y:this.pos.y},this.angle,r,!0);this.pos.x=e.x,this.pos.y=e.y,this.angle=n}this.box_type=a}getNextPointWalking(t,e=this.angle,n=this.speed){const s=this.pos.x+Math.cos(e)*n*t,o=this.pos.y+Math.sin(e)*n*t;return{x:s,y:o}}update(t){}}n(1703);const d={x:1/0,y:1/0};function f(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}class p{constructor(){(0,c.Z)(this,"map_info",{boxes:[],playerPos:{x:5,y:5}}),(0,c.Z)(this,"size",{x:10,y:10}),this.load()}get boxes(){return this.map_info.boxes}load(){this.map_info.boxes=[1,1,1,1,1,1,1,1,1,1,1,2,1,0,0,0,0,1,3,1,1,0,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,1,1,2,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,3,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1]}to_index(t){return Math.floor(t.x)+Math.floor(t.y)*this.size.x}box(t,e,n=!1){if(t=Math.floor(t),e=Math.floor(e),this.isOutOfBound({x:t,y:e})){if(n)return 1;throw new Error(`Out of bound : {x:${t}, y:${e}}`)}return this.boxes[t+e*this.size.x]}isOutOfBound({x:t,y:e}){return t<0||e<0||t>=this.size.x||e>=this.size.y}setBox(t,e){const n=this.to_index(t);Math.floor(this.boxes[n])!==e||e<2?this.boxes[n]=e:(this.boxes[n]+=.25,this.boxes[n]-e===1&&this.boxes[n]--)}getNextPoint({x:t,y:e},n){const s=t=>(t+u.dX)%u.dX;n=s(n);const o=[],i=[],r=[];let a="HORIZONTAL";const h=()=>n>Math.PI?"UP":"DOWN",c=()=>n>u.f5&&n<3*u.f5?"LEFT":"RIGHT";let l=t,p=e,y=t,x=e;const g=()=>{let t=0,e=0;return y%1===0&&"LEFT"===c()&&(t=-1),x%1===0&&"UP"===h()&&(e=-1),i.push({x:Math.floor(y)+t,y:Math.floor(x)+e}),this.box(Math.floor(y)+t,Math.floor(x)+e,!0)};let m=0,v=0;try{do{if(v++>100)return{point:d,distance:1/0,wallCol:0,from:a,pointsToDraw:[],pointBreak:r,squaresToDraw:[]};const t=y%1+(y%1===0&&"LEFT"===c()?1:0),e=1-t,i=x%1+(x%1===0&&"UP"===h()?1:0),b=1-i,T=s(Math.atan2(b,e)),w=s(Math.atan2(b,-t)),k=s(Math.atan2(-i,-t)),E=s(Math.atan2(-i,e));let O;const L=y,M=x;n<T?(y=y-y%1+1,x=(y-l)*Math.tan(n)+p,a="VERTICAL",O="RIGHT"):n<w?(x=x-x%1+1,y=(p-x)*Math.tan(n-u.f5)+l,a="HORIZONTAL",O="DOWN"):n<k?(y-=y%1===0?1:y%1,x=(y-l)*Math.tan(n-u.pi)+p,a="VERTICAL",O="LEFT"):n<E?(x-=x%1===0?1:x%1,y=(p-x)*Math.tan(n-u.f5)+l,a="HORIZONTAL",O="UP"):(y=y-y%1+1,x=(y-l)*Math.tan(n)+p,a="VERTICAL",O="RIGHT"),l=L,p=M,m+=f({x:l,y:p},{x:y,y:x}),o.push({x:y,y:x});const P=g();if(P>1){const{v:t,angle:e}=this.getThrough({x:y,y:x},n,O);y=t.x,x=t.y,l=y,p=x,n=e,r.push(o.length),o.push({x:y,y:x})}}while(1!==g())}catch(T){console.error(T)}const b=("HORIZONTAL"===a?y:x)%1;return{point:{x:y,y:x},distance:m,wallCol:b,from:a,pointsToDraw:o,pointBreak:r,squaresToDraw:i}}getThrough(t,e,n,s=!1){const o=this.getOtherBox(t.x-(t.x%1===0&&"LEFT"===n?1:0),t.y-(t.y%1===0&&"UP"===n?1:0)),i=this.box(t.x-(t.x%1===0&&"LEFT"===n?1:0),t.y-(t.y%1===0&&"UP"===n?1:0))%1/.25,r={x:t.x%1,y:t.y%1};if(2==i)return"UP"==n||"DOWN"==n?(r.x=1-r.x,r.y="UP"===n?1-r.y:-1*r.y,s&&"UP"===n&&o.y++):(r.y=1-r.y,r.x="LEFT"===n?1-r.x:-1*r.x,s&&"LEFT"===n&&o.x++),{v:{x:o.x+r.x,y:o.y+r.y},angle:(e+u.pi)%u.dX};const a=["UP","RIGHT","DOWN","LEFT"];for(let h=0;h<i;h++){const t=r.x;r.x=1-r.y,r.y=t,n=a[(a.indexOf(n)+1)%4],e=(e+u.f5)%u.dX}switch(0===i&&n){case"DOWN":o.y++;break;case"RIGHT":o.x++;break}switch(0===i&&s&&n){case"UP":o.y--;break;case"LEFT":o.x--;break}switch(1==i&&s&&n){case"DOWN":o.y++;break;case"RIGHT":o.x++;break;case"UP":o.y--;break;case"LEFT":o.x--;break}switch(1==i&&!s&&n){case"LEFT":o.x--;break;case"DOWN":o.y++;break}switch(3===i&&n){case"UP":o.y--;break;case"RIGHT":o.x++}switch(3===i&&s&&n){case"LEFT":o.x--;break;case"DOWN":o.y++;break}return{v:{x:o.x+r.x,y:o.y+r.y},angle:e}}getOtherBox(t,e){t=Math.floor(t),e=Math.floor(e);const n=Math.floor(this.box(t,e));if(n<=1)throw new Error(n+" can not be a teleporter");for(let s=0;s<this.boxes.length;s++)if(Math.floor(this.boxes[s])===n&&s!==t+e*this.size.x)return{x:s%this.size.x,y:Math.floor(s/this.size.x)};throw new Error(`Can't find other box of type ${n}`)}}class y{constructor(t){(0,c.Z)(this,"game",void 0),(0,c.Z)(this,"UP",!1),(0,c.Z)(this,"DOWN",!1),(0,c.Z)(this,"LEFT",!1),(0,c.Z)(this,"RIGHT",!1),(0,c.Z)(this,"STRAFE_LEFT",!1),(0,c.Z)(this,"STRAFE_RIGHT",!1),this.game=t,this.bindEvents()}update(t){const e=this.game.player.rotation_speed;this.RIGHT?this.game.player.addAngle(u.Ly*e*t):this.LEFT&&this.game.player.addAngle(-u.Ly*e*t);const n=this.STRAFE_LEFT||this.STRAFE_RIGHT,s=this.UP||this.DOWN;if(!n&&!s)return;let o=1,i=0,r=this.game.player.angle;n&&(i=this.STRAFE_RIGHT?u.f5:-u.f5),s&&(this.DOWN&&(r+=u.pi),n&&(i/=this.DOWN?-2:2,o=1/Math.sqrt(2))),this.game.player.walk(this.game.map,t*o,r+i)}bindEvents(){const t=t=>{const e="keydown"===t.type;switch(t.code){case"KeyW":this.UP=e;break;case"KeyS":this.DOWN=e;break;case"KeyQ":this.LEFT=e;break;case"KeyE":this.RIGHT=e;break;case"KeyA":this.STRAFE_LEFT=e;break;case"KeyD":this.STRAFE_RIGHT=e;break}};document.addEventListener("keydown",t),document.addEventListener("keyup",t)}}var x=n(872);class g{constructor(t=40){(0,c.Z)(this,"fps",void 0),(0,c.Z)(this,"player",void 0),(0,c.Z)(this,"map",void 0),(0,c.Z)(this,"controller",void 0),(0,c.Z)(this,"interval",void 0),(0,c.Z)(this,"view_angle",80),(0,c.Z)(this,"last_tick",0),this.fps=t,console.log("Instanciating Game class"),this.controller=new y(this),this.map=new p,this.player=new l(this.map.map_info.playerPos)}init(){return console.log("Waiting for textures to load"),(0,x.C)().then((()=>{console.log("Textures loaded",x.P)}))}loop(t){this.interval=setTimeout((()=>this.loop(t)),1e3/this.fps);const e=(new Date).getTime()/1e3,n=e-this.last_tick;this.last_tick=e,this.update(n),this.render(n,t)}stop(){clearTimeout(this.interval)}render(t,e){e.forEach((e=>e.drawContext(this,t)))}update(t){this.controller.update(t),this.player.update(this.map)}}var m=n(2483);const v=[{path:"/play",name:"play",component:()=>n.e(241).then(n.bind(n,7241))},{path:"/edit",name:"edit",component:()=>n.e(26).then(n.bind(n,6026))},{path:"/*",redirect:"/play"}],b=(0,m.p7)({history:(0,m.PO)(),routes:v});var T=(0,o.aZ)({name:"App",data(){return{inited:!1,game:new g}},mounted(){this.game.init().then((()=>this.inited=!0)),document.addEventListener("keypress",(t=>{"KeyP"===t.code&&b.push("play"===this.$route.name?"/edit":"play")}))}}),w=n(89);const k=(0,w.Z)(T,[["render",h]]);var E=k;(0,s.ri)(E).use(b).mount("#app")}},e={};function n(s){var o=e[s];if(void 0!==o)return o.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,n),i.exports}n.m=t,function(){var t=[];n.O=function(e,s,o,i){if(!s){var r=1/0;for(u=0;u<t.length;u++){s=t[u][0],o=t[u][1],i=t[u][2];for(var a=!0,h=0;h<s.length;h++)(!1&i||r>=i)&&Object.keys(n.O).every((function(t){return n.O[t](s[h])}))?s.splice(h--,1):(a=!1,i<r&&(r=i));if(a){t.splice(u--,1);var c=o();void 0!==c&&(e=c)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[s,o,i]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,s){return n.f[s](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{26:"ca61760a",241:"400c3dfa"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/"+t+".63e9c973.css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="maze-squared:";n.l=function(s,o,i,r){if(t[s])t[s].push(o);else{var a,h;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var l=c[u];if(l.getAttribute("src")==s||l.getAttribute("data-webpack")==e+i){a=l;break}}a||(h=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+i),a.src=s),t[s]=[o];var d=function(e,n){a.onerror=a.onload=null,clearTimeout(f);var o=t[s];if(delete t[s],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((function(t){return t(n)})),e)return e(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),h&&document.head.appendChild(a)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/maze-squared/"}(),function(){var t=function(t,e,n,s){var o=document.createElement("link");o.rel="stylesheet",o.type="text/css";var i=function(i){if(o.onerror=o.onload=null,"load"===i.type)n();else{var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.href||e,h=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");h.code="CSS_CHUNK_LOAD_FAILED",h.type=r,h.request=a,o.parentNode.removeChild(o),s(h)}};return o.onerror=o.onload=i,o.href=e,document.head.appendChild(o),o},e=function(t,e){for(var n=document.getElementsByTagName("link"),s=0;s<n.length;s++){var o=n[s],i=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(i===t||i===e))return o}var r=document.getElementsByTagName("style");for(s=0;s<r.length;s++){o=r[s],i=o.getAttribute("data-href");if(i===t||i===e)return o}},s=function(s){return new Promise((function(o,i){var r=n.miniCssF(s),a=n.p+r;if(e(r,a))return o();t(s,a,o,i)}))},o={143:0};n.f.miniCss=function(t,e){var n={26:1};o[t]?e.push(o[t]):0!==o[t]&&n[t]&&e.push(o[t]=s(t).then((function(){o[t]=0}),(function(e){throw delete o[t],e})))}}(),function(){var t={143:0};n.f.j=function(e,s){var o=n.o(t,e)?t[e]:void 0;if(0!==o)if(o)s.push(o[2]);else{var i=new Promise((function(n,s){o=t[e]=[n,s]}));s.push(o[2]=i);var r=n.p+n.u(e),a=new Error,h=function(s){if(n.o(t,e)&&(o=t[e],0!==o&&(t[e]=void 0),o)){var i=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;a.message="Loading chunk "+e+" failed.\n("+i+": "+r+")",a.name="ChunkLoadError",a.type=i,a.request=r,o[1](a)}};n.l(r,h,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,s){var o,i,r=s[0],a=s[1],h=s[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(h)var u=h(n)}for(e&&e(s);c<r.length;c++)i=r[c],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(u)},s=self["webpackChunkmaze_squared"]=self["webpackChunkmaze_squared"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(9182)}));s=n.O(s)})();
//# sourceMappingURL=app.b3301442.js.map